<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <style>
        body {
            font-family: "Arial", sans-serif;
            margin: 50px 50px 50px 60px;
        }
    </style>

</head>

<body>
    <div>
    <h1>Feature Drift</h1>
    <p>Important features drift through two dataset</p>
    </div>
    <div id="graphic"></div>

    <script>
        var bar_left_data = [{'relative_imp': 1.0, 'feat_name': 'feat_70', 'bar_mark': '1', 'pos': 'left', 'bar_color': '#d53e4f', 'font_color': '#67000d'}, {'relative_imp': 0.406, 'feat_name': 'feat_27', 'bar_mark': '1', 'pos': 'left', 'bar_color': '#d53e4f', 'font_color': '#67000d'}, {'relative_imp': 0.377, 'feat_name': 'feat_67', 'bar_mark': '1', 'pos': 'left', 'bar_color': '#66c2a5', 'font_color': '#00441b'}, {'relative_imp': 0.369, 'feat_name': 'feat_43', 'bar_mark': '1', 'pos': 'left', 'bar_color': '#d53e4f', 'font_color': '#67000d'}, {'relative_imp': 0.324, 'feat_name': 'feat_79', 'bar_mark': '1', 'pos': 'left', 'bar_color': '#66c2a5', 'font_color': '#00441b'}, {'relative_imp': 0.263, 'feat_name': 'feat_4', 'bar_mark': '1', 'pos': 'left', 'bar_color': '#66c2a5', 'font_color': '#00441b'}, {'relative_imp': 0.255, 'feat_name': 'feat_16', 'bar_mark': '1', 'pos': 'left', 'bar_color': '#66c2a5', 'font_color': '#00441b'}, {'relative_imp': 0.224, 'feat_name': 'feat_72', 'bar_mark': '1', 'pos': 'left', 'bar_color': '#66c2a5', 'font_color': '#00441b'}, {'relative_imp': 0.152, 'feat_name': 'feat_75', 'bar_mark': '0', 'pos': 'left', 'bar_color': '#969696', 'font_color': '#525252'}, {'relative_imp': 0.152, 'feat_name': 'feat_61', 'bar_mark': '1', 'pos': 'left', 'bar_color': '#66c2a5', 'font_color': '#00441b'}, {'relative_imp': 0.141, 'feat_name': 'feat_77', 'bar_mark': '0', 'pos': 'left', 'bar_color': '#969696', 'font_color': '#525252'}, {'relative_imp': 0.137, 'feat_name': 'feat_12', 'bar_mark': '0', 'pos': 'left', 'bar_color': '#969696', 'font_color': '#525252'}, {'relative_imp': 0.128, 'feat_name': 'feat_49', 'bar_mark': '0', 'pos': 'left', 'bar_color': '#969696', 'font_color': '#525252'}, {'relative_imp': 0.126, 'feat_name': 'feat_29', 'bar_mark': '1', 'pos': 'left', 'bar_color': '#d53e4f', 'font_color': '#67000d'}, {'relative_imp': 0.122, 'feat_name': 'feat_41', 'bar_mark': '1', 'pos': 'left', 'bar_color': '#66c2a5', 'font_color': '#00441b'}, {'relative_imp': 0.118, 'feat_name': 'feat_48', 'bar_mark': '1', 'pos': 'left', 'bar_color': '#66c2a5', 'font_color': '#00441b'}, {'relative_imp': 0.113, 'feat_name': 'feat_3', 'bar_mark': '1', 'pos': 'left', 'bar_color': '#66c2a5', 'font_color': '#00441b'}, {'relative_imp': 0.107, 'feat_name': 'feat_45', 'bar_mark': '1', 'pos': 'left', 'bar_color': '#66c2a5', 'font_color': '#00441b'}, {'relative_imp': 0.106, 'feat_name': 'feat_47', 'bar_mark': '0', 'pos': 'left', 'bar_color': '#969696', 'font_color': '#525252'}, {'relative_imp': 0.105, 'feat_name': 'feat_17', 'bar_mark': '0', 'pos': 'left', 'bar_color': '#969696', 'font_color': '#525252'}],
            bar_right_data = [{'relative_imp': 1.0, 'feat_name': 'feat_72', 'bar_mark': '1', 'pos': 'right', 'bar_color': '#66c2a5', 'font_color': '#00441b'}, {'relative_imp': 0.852, 'feat_name': 'feat_70', 'bar_mark': '1', 'pos': 'right', 'bar_color': '#d53e4f', 'font_color': '#67000d'}, {'relative_imp': 0.717, 'feat_name': 'feat_67', 'bar_mark': '1', 'pos': 'right', 'bar_color': '#66c2a5', 'font_color': '#00441b'}, {'relative_imp': 0.694, 'feat_name': 'feat_16', 'bar_mark': '1', 'pos': 'right', 'bar_color': '#66c2a5', 'font_color': '#00441b'}, {'relative_imp': 0.609, 'feat_name': 'feat_79', 'bar_mark': '1', 'pos': 'right', 'bar_color': '#66c2a5', 'font_color': '#00441b'}, {'relative_imp': 0.537, 'feat_name': 'feat_4', 'bar_mark': '1', 'pos': 'right', 'bar_color': '#66c2a5', 'font_color': '#00441b'}, {'relative_imp': 0.429, 'feat_name': 'feat_43', 'bar_mark': '1', 'pos': 'right', 'bar_color': '#d53e4f', 'font_color': '#67000d'}, {'relative_imp': 0.344, 'feat_name': 'feat_61', 'bar_mark': '1', 'pos': 'right', 'bar_color': '#66c2a5', 'font_color': '#00441b'}, {'relative_imp': 0.231, 'feat_name': 'feat_3', 'bar_mark': '1', 'pos': 'right', 'bar_color': '#66c2a5', 'font_color': '#00441b'}, {'relative_imp': 0.197, 'feat_name': 'feat_41', 'bar_mark': '1', 'pos': 'right', 'bar_color': '#66c2a5', 'font_color': '#00441b'}, {'relative_imp': 0.187, 'feat_name': 'feat_48', 'bar_mark': '1', 'pos': 'right', 'bar_color': '#66c2a5', 'font_color': '#00441b'}, {'relative_imp': 0.185, 'feat_name': 'feat_45', 'bar_mark': '1', 'pos': 'right', 'bar_color': '#66c2a5', 'font_color': '#00441b'}, {'relative_imp': 0.185, 'feat_name': 'feat_71', 'bar_mark': '0', 'pos': 'right', 'bar_color': '#74a9cf', 'font_color': '#08306b'}, {'relative_imp': 0.181, 'feat_name': 'feat_62', 'bar_mark': '0', 'pos': 'right', 'bar_color': '#74a9cf', 'font_color': '#08306b'}, {'relative_imp': 0.17, 'feat_name': 'feat_29', 'bar_mark': '1', 'pos': 'right', 'bar_color': '#d53e4f', 'font_color': '#67000d'}, {'relative_imp': 0.168, 'feat_name': 'feat_60', 'bar_mark': '0', 'pos': 'right', 'bar_color': '#74a9cf', 'font_color': '#08306b'}, {'relative_imp': 0.145, 'feat_name': 'feat_21', 'bar_mark': '0', 'pos': 'right', 'bar_color': '#74a9cf', 'font_color': '#08306b'}, {'relative_imp': 0.137, 'feat_name': 'feat_27', 'bar_mark': '1', 'pos': 'right', 'bar_color': '#d53e4f', 'font_color': '#67000d'}, {'relative_imp': 0.136, 'feat_name': 'feat_11', 'bar_mark': '0', 'pos': 'right', 'bar_color': '#74a9cf', 'font_color': '#08306b'}, {'relative_imp': 0.133, 'feat_name': 'feat_46', 'bar_mark': '0', 'pos': 'right', 'bar_color': '#74a9cf', 'font_color': '#08306b'}],
            line_data = [{'bar_color': '#d53e4f', 'feat_name': 'feat_70'}, {'bar_color': '#d53e4f', 'feat_name': 'feat_27'}, {'bar_color': '#66c2a5', 'feat_name': 'feat_67'}, {'bar_color': '#d53e4f', 'feat_name': 'feat_43'}, {'bar_color': '#66c2a5', 'feat_name': 'feat_79'}, {'bar_color': '#66c2a5', 'feat_name': 'feat_4'}, {'bar_color': '#66c2a5', 'feat_name': 'feat_16'}, {'bar_color': '#66c2a5', 'feat_name': 'feat_72'}, {'bar_color': '#66c2a5', 'feat_name': 'feat_61'}, {'bar_color': '#d53e4f', 'feat_name': 'feat_29'}, {'bar_color': '#66c2a5', 'feat_name': 'feat_41'}, {'bar_color': '#66c2a5', 'feat_name': 'feat_48'}, {'bar_color': '#66c2a5', 'feat_name': 'feat_3'}, {'bar_color': '#66c2a5', 'feat_name': 'feat_45'}];

        var max_bar_width = 300;
        var bar_height = 30;
        var middle_gap = 300;
        var fontsize = '12px';

        var width = max_bar_width * 2 + middle_gap,
            height = bar_left_data.length * bar_height * 1.1;

        var svg = d3.select("#graphic").append("svg")
            .attr("width", width + 10)
            .attr("height", height)
            .append("g");
            //.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var x = d3.scale.linear()
            .range([0, max_bar_width])
            .domain([0, 1.0]);

        var y_left = d3.scale.ordinal()
                .rangeRoundBands([0, bar_left_data.length * bar_height], .1)
                .domain(bar_left_data.map(function (d) {
                    return d.feat_name;
                }));

        var y_right = d3.scale.ordinal()
                .rangeRoundBands([0, bar_right_data.length * bar_height], .1)
                .domain(bar_right_data.map(function (d) {
                    return d.feat_name;
                }));

        updateBar('left', bar_left_data);
        updateBar('right', bar_right_data);
        updateLines();

        function updateBar(pos, bar_data) {

            var bar_x = 0,
                bg_bar_class = 'bg_bar_left',
                bar_class = 'bar_left',
                y = y_left, 
                other_pos = 'right';

            if (pos == 'right') {
                bar_x = max_bar_width + middle_gap;
                bg_bar_class = 'bg_bar_right';
                bar_class = 'bar_right';
                y = y_right;
                other_pos = 'left';
            }

            var bg_bars = svg.selectAll("." + bg_bar_class)
                .data(bar_data)
                .enter()
                .append("g")

            bg_bars.append("rect")
                .attr("class", bg_bar_class)
                .attr("y", function (d) {
                    return y(d.feat_name);
                })
                .attr("height", y.rangeBand())
                .attr("x", bar_x)
                .attr("width", max_bar_width)
                .style("fill", '#f0f0f0')
                .on("mouseover", barHover)
                .on("mouseout", barOut);

            var bars = svg.selectAll("." + bar_class)
                .data(bar_data)
                .enter()
                .append("g");

            bars.append("rect")
                .attr("class", bar_class)
                .attr("y", function (d) {
                    return y(d.feat_name);
                })
                .attr("height", y.rangeBand())
                .attr("x", bar_x)
                .attr("width", function (d) {
                    return x(d.relative_imp);
                })
                .style('fill', function (d){
                    return d.bar_color;
                })                
                .on("mouseover", barHover)
                .on("mouseout", barOut);

            bars.append("text")
                .attr("class", "label")
                .attr("y", function (d) {
                    return y(d.feat_name) + y.rangeBand() / 2 + 4;
                })
                .attr("x", bar_x+5)
                .text(function (d) {
                    return d.feat_name;
                })
                .style('fill', function(d) { return d.font_color;})
                .style('font-size', fontsize);
        }

        function updateLines() {

            var lines = svg.selectAll(".lines")
                .data(line_data)
                .enter()
                .append("g");

            lines.append("line")
                .attr("class", "lines")
                .attr('x1', max_bar_width)
                .attr('y1', function (d) {
                    return y_left(d.feat_name) + y_left.rangeBand() / 2
                })
                .attr('x2', max_bar_width + middle_gap)
                .attr('y2', function (d) {
                    return y_right(d.feat_name) + y_right.rangeBand() / 2
                })
                .style('stroke', function (d) {
                    return d.bar_color;
                });

        }


        function barHover(d) {
            d3.selectAll('.bg_bar_' + d.pos).filter(function(o) {
                return o.feat_name == d.feat_name;
            })
            .style("stroke", d.bar_color)
            .style("stroke-width", 2);

            var other_pos = 'right';
            if (d.pos == 'right') other_pos = 'left';

            if (d.bar_mark == '1') {
                d3.selectAll('.bg_bar_' + other_pos).filter(function(o) {
                    return o.feat_name == d.feat_name;
                })
                .style("stroke", d.bar_color)
                .style("stroke-width", 2);

                d3.selectAll('.lines').filter(function(l) {
                    return l.feat_name == d.feat_name;
                })
                .style("stroke-width", 4);
            }
        }


        function barOut(d) {

            d3.selectAll('.bg_bar_' + d.pos).filter(function(o) {
                return o.feat_name == d.feat_name;
            })
            .style("stroke", null);

            var other_pos = 'right';
            if (d.pos == 'right') other_pos = 'left';

            if (d.bar_mark == '1') {
                d3.selectAll('.bg_bar_' + other_pos).filter(function(o) {
                    return o.feat_name == d.feat_name;
                })
                .style("stroke", null);

                d3.selectAll('.lines').filter(function(l) {
                    return l.feat_name == d.feat_name;
                })
                .style("stroke-width", 1);
            }
        }

    </script>
</body>
</html>